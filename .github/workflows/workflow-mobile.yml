name: Workflow - Tests on Mobile

on:
  workflow_call:
    inputs:
      repository:
        required: true
        type: string
      gitref:
        required: true
        type: string
      mobile_percy_project:
        required: false
        type: string
      pixeleagle_project:
        required: true
        type: string
      branch:
        required: true
        type: string

jobs:
  build-for-iOS:
    runs-on: macos-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.gitref }}

      - uses: dtolnay/rust-toolchain@stable

      - name: Add iOS targets
        run: rustup target add aarch64-apple-ios x86_64-apple-ios

  build-for-Android:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.gitref }}

      - uses: dtolnay/rust-toolchain@stable

      - name: Add Android targets
        run: rustup target add aarch64-linux-android armv7-linux-androideabi

      - name: Install Cargo APK
        run: cargo install --force cargo-apk
