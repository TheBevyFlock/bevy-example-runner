name: Workflow - Tests on wasm

on:
  workflow_call:
    inputs:
      repository:
        required: true
        type: string
        default: 'bevyengine/bevy'
      gitref:
        required: true
        type: string
      pixeleagle_project:
        required: true
        type: string
      branch:
        required: true
        type: string
        default: 'main'
      per_page:
        required: true
        type: number

jobs:
  split-pages:
    name: Prepare pages
    runs-on: ubuntu-latest
    outputs:
      pages: ${{ steps.env.outputs.pages }}
    steps:
      - name: Checkout Bevy main branch
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repository}}
      - name: Prepare Pages
        id: env
        run: |
          example_count=`cat Cargo.toml | grep '\[\[example\]\]' | wc -l`
          page_count=$((example_count / ${{ inputs.per_page }} + 1))
          echo "pages=`python -c \"import json; print(json.dumps([i for i in range($page_count)]))\"`" >> $GITHUB_OUTPUT

  take-screenshots:
    name: Take Screenshots
    needs: [split-pages]
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-14]
        page: ${{ fromJSON(needs.split-pages.outputs.pages) }}

    steps:

      - name: Checkout Bevy main branch
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.gitref }}
